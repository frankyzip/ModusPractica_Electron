<Window
    x:Class="ModusPractica.SettingsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:ModusPractica"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="Settings"
    Width="850"
    Height="700"
    Background="#F8F8F8"
    ResizeMode="NoResize"
    WindowStartupLocation="CenterOwner"
    mc:Ignorable="d">

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock
            Grid.Row="0"
            Margin="0,0,0,20"
            FontSize="20"
            FontWeight="SemiBold"
            Text="Application Settings"/>

        <TabControl Grid.Row="1"
                    VerticalAlignment="Stretch"
                    Background="White">

            <!-- General Tab -->
            <TabItem Header="General"
                     Background="White">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20"
                                VerticalAlignment="Top">

                        <GroupBox Padding="10"
                                  Header="Display &amp; Language">
                            <StackPanel>
                                <TextBlock Margin="0,0,0,5"
                                           Text="Application Language &amp; Region:"/>
                                <TextBlock
                                    Margin="0,0,0,10"
                                    FontStyle="Italic"
                                    Foreground="Gray"
                                    Text="This affects date, time, and number formats. A restart is required for changes to take full effect."
                                    TextWrapping="Wrap"/>
                                <ComboBox x:Name="CmbCulture"
                                          Padding="5"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox
                            Margin="0,15,0,0"
                            Padding="10"
                            Header="Practice Session">
                            <StackPanel>
                                <CheckBox
                                    x:Name="ChkShowTips"
                                    VerticalContentAlignment="Center"
                                    Content="Active Coaching: Provide direct, interactive advice during practice."/>

                                <CheckBox
                                    x:Name="ChkShowSessionReport"
                                    Margin="0,10,0,0"
                                    VerticalContentAlignment="Center"
                                    Content="Show a detailed report with performance score after each practice session."/>

                                <CheckBox
                                    x:Name="ChkPreferPlannerScore"
                                    Margin="0,10,0,0"
                                    VerticalContentAlignment="Center"
                                    ToolTip="When enabled, the report shows the planner's tempo-agnostic score as the main score. The total score (incl. tempo) remains visible."
                                    Content="Use planner score as primary in session report (tempo-agnostic)."/>

                                <Grid Margin="0,15,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0"
                                               VerticalAlignment="Center"
                                               Text="Interface Mode:"/>
                                    <ComboBox x:Name="CmbPracticeSessionMode"
                                              Grid.Column="1"
                                              Margin="10,0,0,0"
                                              ToolTip="Simple: streamlined interface with post-session evaluation. Advanced: detailed real-time tracking.">
                                        <ComboBoxItem Content="Simple"
                                                      Tag="Simple"/>
                                        <ComboBoxItem Content="Advanced"
                                                      Tag="Advanced"/>
                                    </ComboBox>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox
                            Margin="0,15,0,0"
                            Padding="10"
                            Header="Personalization Profile">
                            <StackPanel>
                                <TextBlock
                                    Margin="0,0,0,10"
                                    FontStyle="Italic"
                                    Foreground="Gray"
                                    Text="This information helps optimize your practice schedule based on memory research."
                                    TextWrapping="Wrap"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Musical Experience -->
                                    <TextBlock Grid.Row="1"
                                               Grid.Column="0"
                                               Margin="0,5,0,5"
                                               VerticalAlignment="Center"
                                               Text="Experience:"/>
                                    <ComboBox x:Name="CmbMusicalExperience"
                                              Grid.Row="1"
                                              Grid.Column="1"
                                              Margin="5,5,0,5"
                                              ToolTip="Your overall musical experience level">
                                        <ComboBoxItem Content="Beginner (0-2 years)"/>
                                        <ComboBoxItem Content="Intermediate (3-7 years)"/>
                                        <ComboBoxItem Content="Advanced (8-15 years)"/>
                                        <ComboBoxItem Content="Professional (15+ years)"/>
                                    </ComboBox>
                                </Grid>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Spaced Repetition Tab -->
            <TabItem Header="Spaced Repetition"
                     Background="White">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">

                        <!-- Global Settings -->
                        <GroupBox Header="Global Settings"
                                  Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0">Global Interval Multiplier:</Label>
                                    <TextBox x:Name="TxtGlobalIntervalMultiplier"
                                             Grid.Column="1"/>
                                    <TextBlock Grid.Column="2"
                                               FontStyle="Italic"
                                               VerticalAlignment="Center"
                                               Margin="10,0">
                                        Increases (>1.0) or decreases (&lt;1.0) all intervals. E.g. 1.2 = 20% longer intervals
                                    </TextBlock>
                                </Grid>

                                <!-- NEW: Override Features -->
                                <CheckBox x:Name="ChkEnableIntervalOverrides"
                                          Margin="0,15,0,5"
                                          Content="Enable interval overrides in session reports"/>
                                <TextBlock FontStyle="Italic"
                                           Foreground="Gray"
                                           Margin="20,0,0,0"
                                           TextWrapping="Wrap">
                                    Allows advanced users (Intermediate+) to manually adjust next practice intervals in session reports
                                </TextBlock>

                                <!-- NEW: Adaptive Systems -->
                                <CheckBox x:Name="ChkUseAdaptiveSystems"
                                          Margin="0,15,0,5"
                                          Content="Enable adaptive tau adjustments"/>
                                <TextBlock FontStyle="Italic"
                                           Foreground="Gray"
                                           Margin="20,0,0,0"
                                           TextWrapping="Wrap">
                                    Automatically adjusts intervals per section based on your SuccessRatio. Requires restart to take effect.
                                </TextBlock>
                            </StackPanel>
                        </GroupBox>

                        <!-- Experience Level Multipliers -->
                        <GroupBox Header="Experience Level Adjustments"
                                  Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0">Beginner Tau Multiplier:</Label>
                                    <TextBox x:Name="TxtBeginnerTauMultiplier"
                                             Grid.Column="1"/>
                                    <TextBlock Grid.Column="2"
                                               FontStyle="Italic"
                                               VerticalAlignment="Center"
                                               Margin="10,0">
                                        Lower value (&lt;1.0) = shorter intervals for beginners. Default: 1.0
                                    </TextBlock>
                                </Grid>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0">Intermediate Tau Multiplier:</Label>
                                    <TextBox x:Name="TxtIntermediateTauMultiplier"
                                             Grid.Column="1"/>
                                    <TextBlock Grid.Column="2"
                                               FontStyle="Italic"
                                               VerticalAlignment="Center"
                                               Margin="10,0">
                                        Reference value for intermediate players. Default: 1.0 (no adjustment)
                                    </TextBlock>
                                </Grid>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0">Advanced Tau Multiplier:</Label>
                                    <TextBox x:Name="TxtAdvancedTauMultiplier"
                                             Grid.Column="1"/>
                                    <TextBlock Grid.Column="2"
                                               FontStyle="Italic"
                                               VerticalAlignment="Center"
                                               Margin="10,0">
                                        Higher value (>1.0) = longer intervals for advanced players. Default: 1.2
                                    </TextBlock>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <!-- Retention Targets per Difficulty -->
                        <GroupBox Header="Retention Targets per Difficulty Level"
                                  Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0">Easy Retention Target:</Label>
                                    <TextBox x:Name="TxtEasyRetentionTarget"
                                             Grid.Column="1"/>
                                    <TextBlock Grid.Column="2"
                                               FontStyle="Italic"
                                               VerticalAlignment="Center"
                                               Margin="10,0">
                                        Desired recall % for easy pieces. Lower = longer intervals. Default: 75%
                                    </TextBlock>
                                </Grid>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0">Average Retention Target:</Label>
                                    <TextBox x:Name="TxtAverageRetentionTarget"
                                             Grid.Column="1"/>
                                    <TextBlock Grid.Column="2"
                                               FontStyle="Italic"
                                               VerticalAlignment="Center"
                                               Margin="10,0">
                                        Desired recall % for average pieces. Default: 80%
                                    </TextBlock>
                                </Grid>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0">Difficult Retention Target:</Label>
                                    <TextBox x:Name="TxtDifficultRetentionTarget"
                                             Grid.Column="1"/>
                                    <TextBlock Grid.Column="2"
                                               FontStyle="Italic"
                                               VerticalAlignment="Center"
                                               Margin="10,0">
                                        Desired recall % for difficult pieces. Higher = shorter intervals. Default: 85%
                                    </TextBlock>
                                </Grid>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0">Mastered Retention Target:</Label>
                                    <TextBox x:Name="TxtMasteredRetentionTarget"
                                             Grid.Column="1"/>
                                    <TextBlock Grid.Column="2"
                                               FontStyle="Italic"
                                               VerticalAlignment="Center"
                                               Margin="10,0">
                                        Desired recall % for mastered pieces. Default: 90%
                                    </TextBlock>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <!-- Performance & Frustration Settings -->
                        <GroupBox Header="Performance &amp; Frustration Settings"
                                  Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0">Performance Penalty Threshold:</Label>
                                    <TextBox x:Name="TxtPerformancePenaltyThreshold"
                                             Grid.Column="1"/>
                                    <TextBlock Grid.Column="2"
                                               FontStyle="Italic"
                                               VerticalAlignment="Center"
                                               Margin="10,0">
                                        Score below this value shortens the next interval (penalty). Default: 5.0
                                    </TextBlock>
                                </Grid>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0">Frustration Cooldown Days:</Label>
                                    <TextBox x:Name="TxtFrustrationCooldownDays"
                                             Grid.Column="1"/>
                                    <TextBlock Grid.Column="2"
                                               FontStyle="Italic"
                                               VerticalAlignment="Center"
                                               Margin="10,0">
                                        Number of days break after automatic frustration detection. Default: 3.0
                                    </TextBlock>
                                </Grid>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0">Manual Frustration Cooldown:</Label>
                                    <TextBox x:Name="TxtManualFrustrationCooldownDays"
                                             Grid.Column="1"/>
                                    <TextBlock Grid.Column="2"
                                               FontStyle="Italic"
                                               VerticalAlignment="Center"
                                               Margin="10,0">
                                        Number of days break after manual frustration marking. Default: 2.0
                                    </TextBlock>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <!-- Reset to Defaults -->
                        <Button x:Name="BtnResetSpacedRepetition"
                                Content="Reset to Defaults"
                                Width="200"
                                HorizontalAlignment="Left"
                                Margin="0,10"
                                Click="BtnResetSpacedRepetition_Click"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

        </TabControl>

        <StackPanel
            Grid.Row="2"
            Margin="0,15,0,0"
            HorizontalAlignment="Right"
            Orientation="Horizontal">
            <Button
                x:Name="BtnSave"
                Width="100"
                Height="30"
                Margin="0,0,10,0"
                Background="#4A86E8"
                Content="Save"
                Foreground="White"/>
            <Button
                x:Name="BtnCancel"
                Width="100"
                Height="30"
                Content="Cancel"/>
        </StackPanel>
    </Grid>
</Window>